<div class="seller-checkout-container">
  <p-toast></p-toast>
  <p-confirmDialog></p-confirmDialog>

  <div class="grid">
    <div class="col-12">
      <p-card>
        <ng-template pTemplate="header">
          <div class="p-3">
            <h2 class="m-0">Seller Checkout</h2>
            <p class="text-600 m-0">Scan barcode or enter manually to find items</p>
          </div>
        </ng-template>

        <!-- Barcode Scanner Input -->
        <div class="field">
          <label for="barcode">Barcode</label>
          <div class="p-inputgroup">
            <span class="p-inputgroup-addon">
              <i class="pi pi-qrcode"></i>
            </span>
            <input
              id="barcode"
              type="text"
              pInputText
              [(ngModel)]="barcode"
              (keydown)="onBarcodeInput($event)"
              placeholder="Scan or enter barcode"
              [disabled]="isLoading || isProcessing"
              autofocus
            />
            <button
              pButton
              type="button"
              (click)="findItem()"
              [disabled]="!barcode.trim() || isLoading || isProcessing"
            >
              <i class="pi pi-search" *ngIf="!isLoading"></i>
              <i *ngIf="isLoading" class="pi pi-spin pi-spinner"></i>
              <span class="ml-2">Find</span>
            </button>
          </div>
        </div>

        <!-- Loading Spinner -->
        <div *ngIf="isLoading" class="flex justify-content-center my-4">
          <p-progressSpinner></p-progressSpinner>
        </div>

        <!-- Item Details -->
        <div *ngIf="item && !isLoading" class="mt-4">
          <p-card>
            <ng-template pTemplate="header">
              <div class="flex justify-content-between align-items-center p-3">
                <h3 class="m-0">{{ item.name }}</h3>
                <button
                  pButton
                  type="button"
                  icon="pi pi-times"
                  class="p-button-rounded p-button-text"
                  (click)="clearItem()"
                ></button>
              </div>
            </ng-template>

            <div class="grid">
              <div class="col-12 md:col-8">
                <div class="field">
                  <label class="font-bold">Description</label>
                  <p>{{ item.description || 'No description' }}</p>
                </div>

                <div class="field">
                  <label class="font-bold">Category</label>
                  <p>{{ item.category || 'Uncategorized' }}</p>
                </div>

                <div class="field">
                  <label class="font-bold">Customer</label>
                  <p>
                    {{ item.customerName }}
                    <span *ngIf="item.customerEmail"> ({{ item.customerEmail }})</span>
                  </p>
                </div>

                <div class="field">
                  <label class="font-bold">Status</label>
                  <p>
                    <span
                      class="px-2 py-1 border-round"
                      [class.bg-green-100]="item.status === 'ForSale'"
                      [class.text-green-800]="item.status === 'ForSale'"
                      [class.bg-red-100]="item.status !== 'ForSale'"
                      [class.text-red-800]="item.status !== 'ForSale'"
                    >
                      {{ item.status }}
                    </span>
                  </p>
                </div>
              </div>

              <div class="col-12 md:col-4">
                <img
                  *ngIf="item.photoUrl"
                  [src]="item.photoUrl"
                  [alt]="item.name"
                  class="w-full border-round"
                />
              </div>
            </div>

            <ng-template pTemplate="footer">
              <div class="flex justify-content-between align-items-center">
                <div>
                  <h3 class="m-0">Price: {{ item.actualPrice || 'Not set' }} PLN</h3>
                  <small class="text-600"
                    >Commission: {{ item.commissionPercentage }}%</small
                  >
                </div>

                <div class="flex gap-2">
                  <!-- Cash Payment Button -->
                  <button
                    *ngIf="availablePaymentMethods?.cashEnabled"
                    pButton
                    type="button"
                    class="p-button-success"
                    (click)="checkout(PaymentMethodType.Cash)"
                    [disabled]="!item.actualPrice || item.status !== 'ForSale' || isProcessing"
                  >
                    <i class="pi pi-money-bill" *ngIf="!isProcessing"></i>
                    <i *ngIf="isProcessing" class="pi pi-spin pi-spinner"></i>
                    <span class="ml-2">Cash</span>
                  </button>

                  <!-- Card Payment Button -->
                  <button
                    *ngIf="availablePaymentMethods?.cardEnabled"
                    pButton
                    type="button"
                    class="p-button-info"
                    (click)="checkout(PaymentMethodType.Card)"
                    [disabled]="!item.actualPrice || item.status !== 'ForSale' || isProcessing"
                  >
                    <i class="pi pi-credit-card" *ngIf="!isProcessing"></i>
                    <i *ngIf="isProcessing" class="pi pi-spin pi-spinner"></i>
                    <span class="ml-2">Card</span>
                  </button>

                  <p-message
                    *ngIf="!availablePaymentMethods?.cashEnabled && !availablePaymentMethods?.cardEnabled"
                    severity="warn"
                    text="No payment methods available"
                  ></p-message>
                </div>
              </div>
            </ng-template>
          </p-card>
        </div>

        <!-- Terminal Status -->
        <div *ngIf="availablePaymentMethods?.cardEnabled" class="mt-3">
          <p-message
            severity="info"
            [text]="'Terminal: ' + (availablePaymentMethods?.terminalProviderName || 'Unknown')"
          ></p-message>
        </div>
      </p-card>
    </div>
  </div>
</div>