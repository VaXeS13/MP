<div class="card">
  <div class="card-header">
    <h3>{{ 'MP::Menu:Promotions' | abpLocalization }}</h3>
  </div>
  <div class="card-body">
    <!-- Filters -->
    <div class="row mb-3">
      <div class="col-md-4">
        <label for="filterText" class="form-label">{{ 'MP::Search' | abpLocalization }}</label>
        <input
          id="filterText"
          type="text"
          class="form-control"
          [(ngModel)]="filters.filterText"
          (ngModelChange)="onFilterChange()"
          [placeholder]="'MP::SearchByNameOrCode' | abpLocalization"
        />
      </div>
      <div class="col-md-3">
        <label for="activeFilter" class="form-label">{{ 'MP::Status' | abpLocalization }}</label>
        <select
          id="activeFilter"
          class="form-select"
          [(ngModel)]="filters.isActive"
          (ngModelChange)="onFilterChange()"
        >
          <option *ngFor="let option of activeFilterOptions" [ngValue]="option.value">
            {{ option.label }}
          </option>
        </select>
      </div>
      <div class="col-md-3">
        <label for="typeFilter" class="form-label">{{ 'MP::PromotionType' | abpLocalization }}</label>
        <select
          id="typeFilter"
          class="form-select"
          [(ngModel)]="filters.type"
          (ngModelChange)="onFilterChange()"
        >
          <option [ngValue]="undefined">All Types</option>
          <option *ngFor="let option of promotionTypeOptions" [ngValue]="option.value">
            {{ 'MP::Enum:PromotionType.' + option.key | abpLocalization }}
          </option>
        </select>
      </div>
      <div class="col-md-2 d-flex align-items-end">
        <button
          type="button"
          class="btn btn-primary w-100"
          (click)="createNew()"
          abpPermission="MP.Promotions.Create"
        >
          <i class="fa fa-plus"></i> {{ 'MP::NewPromotion' | abpLocalization }}
        </button>
      </div>
    </div>

    <!-- Table -->
    <p-table
      [value]="promotions"
      [lazy]="true"
      [paginator]="true"
      [rows]="filters.maxResultCount"
      [totalRecords]="totalCount"
      [loading]="loading"
      (onLazyLoad)="onPageChange($event)"
      [rowsPerPageOptions]="[10, 20, 50]"
      styleClass="p-datatable-gridlines"
    >
      <ng-template pTemplate="header">
        <tr>
          <th style="width: 200px">{{ 'MP::PromotionName' | abpLocalization }}</th>
          <th style="width: 100px">{{ 'MP::Type' | abpLocalization }}</th>
          <th style="width: 120px">{{ 'MP::PromoCode' | abpLocalization }}</th>
          <th style="width: 100px">{{ 'MP::Discount' | abpLocalization }}</th>
          <th style="width: 100px">{{ 'MP::Priority' | abpLocalization }}</th>
          <th style="width: 120px">{{ 'MP::Usage' | abpLocalization }}</th>
          <th style="width: 100px">{{ 'MP::Validity' | abpLocalization }}</th>
          <th style="width: 80px">{{ 'MP::Status' | abpLocalization }}</th>
          <th style="width: 200px">{{ 'MP::Actions' | abpLocalization }}</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-promotion>
        <tr>
          <td>
            <div class="fw-bold">{{ promotion.name }}</div>
            <small class="text-muted">{{ promotion.description }}</small>
          </td>
          <td>
            <span class="badge bg-info">
              {{ 'MP::Enum:PromotionType.' + getPromotionTypeLabel(promotion.type) | abpLocalization }}
            </span>
          </td>
          <td>
            <code *ngIf="promotion.promoCode">{{ promotion.promoCode }}</code>
            <span *ngIf="!promotion.promoCode" class="text-muted">-</span>
          </td>
          <td>
            <strong>{{ getDiscountDisplay(promotion) }}</strong>
          </td>
          <td class="text-center">
            <span class="badge bg-secondary">{{ promotion.priority }}</span>
          </td>
          <td>
            {{ getUsageDisplay(promotion) }}
          </td>
          <td>
            <span
              class="badge"
              [ngClass]="{
                'bg-success': getValidityStatus(promotion) === 'Valid',
                'bg-warning': getValidityStatus(promotion) === 'Not Started',
                'bg-danger': getValidityStatus(promotion) === 'Expired'
              }"
            >
              {{ getValidityStatus(promotion) }}
            </span>
          </td>
          <td>
            <span
              class="badge"
              [ngClass]="promotion.isActive ? 'bg-success' : 'bg-secondary'"
            >
              {{ promotion.isActive ? ('MP::Active' | abpLocalization) : ('MP::Inactive' | abpLocalization) }}
            </span>
          </td>
          <td>
            <div class="btn-group" role="group">
              <button
                type="button"
                class="btn btn-sm btn-primary"
                (click)="edit(promotion.id!)"
                abpPermission="MP.Promotions.Edit"
                title="{{ 'AbpUi::Edit' | abpLocalization }}"
              >
                <i class="fa fa-edit"></i>
              </button>
              <button
                *ngIf="!promotion.isActive"
                type="button"
                class="btn btn-sm btn-success"
                (click)="activate(promotion)"
                abpPermission="MP.Promotions.Manage"
                title="{{ 'MP::Activate' | abpLocalization }}"
              >
                <i class="fa fa-check"></i>
              </button>
              <button
                *ngIf="promotion.isActive"
                type="button"
                class="btn btn-sm btn-warning"
                (click)="deactivate(promotion)"
                abpPermission="MP.Promotions.Manage"
                title="{{ 'MP::Deactivate' | abpLocalization }}"
              >
                <i class="fa fa-pause"></i>
              </button>
              <button
                type="button"
                class="btn btn-sm btn-danger"
                (click)="delete(promotion)"
                abpPermission="MP.Promotions.Delete"
                title="{{ 'AbpUi::Delete' | abpLocalization }}"
              >
                <i class="fa fa-trash"></i>
              </button>
            </div>
          </td>
        </tr>
      </ng-template>
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="9" class="text-center">
            {{ 'MP::NoPromotionsFound' | abpLocalization }}
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>
</div>
