<div class="my-items">
  <div class="page-header">
    <h1>Moje Przedmioty</h1>
    <button pButton label="Dodaj przedmiot" icon="pi pi-plus" (click)="addNewItem()"></button>
  </div>

  <p-card>
    <p-table [value]="items" [loading]="loading" responsiveLayout="scroll" [paginator]="true" [rows]="10">
      <ng-template pTemplate="header">
        <tr>
          <th>Nazwa</th>
          <th>Kategoria</th>
          <th>Stoisko</th>
          <th>Cena szacunkowa</th>
          <th>Cena sprzedaży</th>
          <th>Status</th>
          <th>Data dodania</th>
          <th>Akcje</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-item>
        <tr>
          <td>{{ item.name }}</td>
          <td>{{ item.category || '-' }}</td>
          <td>{{ item.boothNumber }}</td>
          <td>{{ formatCurrency(item.estimatedPrice) }}</td>
          <td>{{ item.actualPrice ? formatCurrency(item.actualPrice) : '-' }}</td>
          <td>
            <p-tag [severity]="getStatusSeverity(item.status)" [value]="getStatusLabel(item.status)"></p-tag>
          </td>
          <td>{{ item.creationTime | date:'dd.MM.yyyy' }}</td>
          <td>
            <button pButton icon="pi pi-pencil" class="p-button-text p-button-sm"
                    (click)="editItem(item)" [disabled]="item.status === 'Sold'"
                    pTooltip="Edytuj"></button>
            <button pButton icon="pi pi-trash" class="p-button-text p-button-sm p-button-danger"
                    (click)="deleteItem(item)" [disabled]="item.status === 'Sold'"
                    pTooltip="Usuń"></button>
          </td>
        </tr>
      </ng-template>
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="8" class="text-center">Brak przedmiotów do wyświetlenia</td>
        </tr>
      </ng-template>
    </p-table>
  </p-card>

  <!-- Add/Edit Dialog -->
  <p-dialog [(visible)]="displayDialog" [header]="isEditMode ? 'Edytuj przedmiot' : 'Dodaj przedmiot'"
            [modal]="true" [style]="{width: '500px'}">
    <div class="p-fluid">
      <div class="field">
        <label for="name">Nazwa *</label>
        <input type="text" pInputText id="name" [(ngModel)]="selectedItem.name" required />
      </div>

      <div class="field">
        <label for="category">Kategoria</label>
        <input type="text" pInputText id="category" [(ngModel)]="selectedItem.category" />
      </div>

      <div class="field">
        <label for="estimatedPrice">Cena szacunkowa (PLN)</label>
        <input type="number" pInputText id="estimatedPrice" [(ngModel)]="selectedItem.estimatedPrice" />
      </div>

      <div class="field">
        <label for="description">Opis</label>
        <textarea pInputTextarea id="description" [(ngModel)]="selectedItem.description" rows="3"></textarea>
      </div>
    </div>

    <ng-template pTemplate="footer">
      <button pButton label="Anuluj" (click)="displayDialog = false" class="p-button-text"></button>
      <button pButton label="Zapisz" (click)="saveItem()" [disabled]="!selectedItem.name"></button>
    </ng-template>
  </p-dialog>
</div>
