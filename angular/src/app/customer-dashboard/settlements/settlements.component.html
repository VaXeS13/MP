<div class="settlements">
  <h1>Rozliczenia</h1>

  <!-- Statistics Cards -->
  <div class="grid mb-3" *ngIf="settlementSummary">
    <div class="col-12 md:col-4">
      <p-card>
        <div class="stat-card">
          <i class="pi pi-money-bill stat-icon"></i>
          <div class="stat-content">
            <span class="stat-label">Całkowite zarobki</span>
            <span class="stat-value">{{ formatCurrency(settlementSummary.totalEarnings) }}</span>
          </div>
        </div>
      </p-card>
    </div>

    <div class="col-12 md:col-4">
      <p-card>
        <div class="stat-card">
          <i class="pi pi-wallet stat-icon"></i>
          <div class="stat-content">
            <span class="stat-label">Do wypłaty</span>
            <span class="stat-value">{{ formatCurrency(settlementSummary.availableForWithdrawal) }}</span>
          </div>
        </div>
      </p-card>
    </div>

    <div class="col-12 md:col-4">
      <p-card>
        <div class="stat-card">
          <i class="pi pi-hourglass stat-icon"></i>
          <div class="stat-content">
            <span class="stat-label">W trakcie</span>
            <span class="stat-value">{{ formatCurrency(settlementSummary.pendingSettlement) }}</span>
          </div>
        </div>
      </p-card>
    </div>
  </div>

  <!-- History Table -->
  <p-card *ngIf="!loading">
    <ng-template pTemplate="header">
      <div class="flex justify-content-between align-items-center p-3">
        <h3>Historia rozliczeń</h3>
        <button pButton label="Zgłoś wypłatę" icon="pi pi-send"
                (click)="requestSettlement()"
                class="p-button-success"></button>
      </div>
    </ng-template>

    <p-table [value]="settlements" [loading]="settlementsLoading" responsiveLayout="scroll"
             [trackBy]="trackBySettlementId">
      <ng-template pTemplate="header">
        <tr>
          <th>Numer</th>
          <th>Data</th>
          <th>Kwota</th>
          <th>Przedmioty</th>
          <th>Status</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-settlement>
        <tr>
          <td>{{ settlement.settlementNumber }}</td>
          <td>{{ settlement.creationTime | date:'dd.MM.yyyy HH:mm' }}</td>
          <td>{{ formatCurrency(settlement.netAmount) }}</td>
          <td>{{ settlement.itemsCount || '-' }}</td>
          <td>
            <p-tag [severity]="getStatusSeverity(settlement.status)"
                   [value]="getStatusLabel(settlement.status)"></p-tag>
          </td>
        </tr>
      </ng-template>

      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="5" class="text-center">Brak rozliczeń</td>
        </tr>
      </ng-template>
    </p-table>
  </p-card>

  <!-- Loading State -->
  <p-progressSpinner *ngIf="loading" class="loading-spinner"></p-progressSpinner>
</div>
