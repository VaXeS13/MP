<p-dialog
  [(visible)]="visible"
  [modal]="true"
  [closable]="true"
  [draggable]="false"
  [resizable]="false"
  [style]="{ width: '90vw', maxWidth: '900px' }"
  [styleClass]="'animated-dialog'"
  header="Edit Booking"
  (onHide)="close()">

  <div *ngIf="loading" class="text-center py-5">
    <p-progressSpinner></p-progressSpinner>
    <p class="mt-3">Loading...</p>
  </div>

  <div *ngIf="!loading && booth">
    <!-- Booth Info -->
    <div class="card mb-3">
      <div class="card-body">
        <h5 class="card-title">
          <i class="fas fa-store me-2"></i>
          Booth #{{ booth.number }}
        </h5>
        <p class="mb-0">
          <strong>Pricing:</strong>
          <span class="text-success fw-bold ms-2">
            {{ getPricingPeriodsDisplay() }}
          </span>
        </p>
        <p *ngIf="calculatedDays > 0" class="mb-0 mt-2">
          <strong>Selected Period:</strong>
          <span class="text-info ms-2">
            <span [innerHTML]="getPriceBreakdownText()"></span>
          </span>
        </p>
        <p *ngIf="calculatedDays > 0" class="mb-0 mt-2">
          <strong>Total Amount:</strong>
          <span class="text-success fw-bold ms-2">
            {{ calculatedPrice | currency:tenantCurrencyCode:'symbol':'1.2-2' }}
          </span>
        </p>
      </div>
    </div>

    <!-- Booth Type Selection -->
    <div class="card mb-3">
      <div class="card-body">
        <h6 class="card-title">
          <i class="fas fa-tags me-2"></i>
          Select Booth Type
        </h6>
        <select
          class="form-select"
          [(ngModel)]="selectedBoothType"
          (change)="onBoothTypeChange()">
          <option [ngValue]="undefined">Select a booth type...</option>
          <option *ngFor="let type of boothTypes; trackBy: trackByBoothTypeId" [ngValue]="type">
            {{ type.name }} ({{ type.commissionPercentage }}% commission)
          </option>
        </select>
      </div>
    </div>

    <!-- Rental Calendar -->
    <app-rental-calendar
      [boothId]="cartItem!.boothId"
      [mode]="'user'"
      [hideBoothInfo]="true"
      [hideBoothTypeSelection]="true"
      [hidePaymentActions]="true"
      [hideCalendarNavigation]="false"
      [hideLegend]="false"
      [preselectedBoothTypeId]="selectedBoothType?.id"
      [excludeCartId]="cartItem!.cartId"
      (datesSelected)="onCalendarDatesSelected($event)"
      (validationError)="onCalendarValidationError($event)"
      (costCalculated)="onCalendarCostCalculated($event)">
    </app-rental-calendar>

    <!-- Notes Section -->
    <div class="card mb-3">
      <div class="card-body">
        <h6 class="card-title">
          <i class="fas fa-comment me-2"></i>
          Notes (Optional)
        </h6>
        <textarea
          class="form-control"
          [(ngModel)]="notes"
          rows="3"
          placeholder="Add any additional notes or special requests..."></textarea>
      </div>
    </div>
  </div>

  <ng-template pTemplate="footer">
    <button
      type="button"
      class="btn btn-secondary"
      (click)="close()">
      <i class="pi pi-times me-2"></i>
      Cancel
    </button>
    <button
      type="button"
      class="btn btn-primary"
      [disabled]="!canSave()"
      (click)="save()">
      <i class="pi pi-check me-2"></i>
      Save Changes
    </button>
  </ng-template>
</p-dialog>